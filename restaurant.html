<!DOCTYPE html>
<html>
    <head>
        <title>Tables</title>
        <meta charset="utf-8"/>
    </head>
    <body>
        <form action="/reservations" method="post">
            <h1>Welcome to Restaurant X reservation system</h1><br></br>
            Select a Restaurant: 
            <select name='tables' id='tables'>
                
            </select>
            First Name:
            <input type="text" id="firstName"/>
            Last Name:
            <input type="text" id="lastName"/>
            Day:
            <input type="text" id="day"/>
            Month:
            <input type="text" id="month"/>
            <input type="submit" id="query" value="Reserve"/>
        </form>
    </body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        var _GlobalTable = '';
        GetTables();

        window.setInterval(function(){
            GetTables();
        }, 5000);

        function GetTables() {
            var day = $('#day').val();
            var month = $('#month').val();
            const Http = new XMLHttpRequest();
            Http.open("GET", 'http://localhost:8080/Tables?rest=1&day=' + day + '&month=' + month);            
            Http.send();
            Http.onreadystatechange = (e) => {
                if(Http.status == 200 && Http.readyState == 4){
                    var str = '';
                    if(_GlobalTable != JSON.parse(Http.response)){
                        _GlobalTable = JSON.parse(Http.response);
                        for(var i = 0; i < JSON.parse(Http.response).length; i++){
                            str = str + '<option value=' + JSON.parse(Http.response)[i]['TableNumber'] + '>' + JSON.parse(Http.response)[i]['TableNumber'] + '</option>';
                        }
                        $('#tables').find('option').remove().end().append(str);
                    }
                }
            }
        }

        $("#day").on('change keydown paste input', function(){
            GetTables();
        });
        $("#month").on('change keydown paste input', function(){
            GetTables();
        });
    </script>
</html>